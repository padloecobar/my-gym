/* ui.css (Aurora Glass Gym UI)
   App-level layout + component refinements on top of globals.
*/

@layer reset, tokens, base, layout, components, motion, utilities, overrides;

@layer tokens {
  :root {
    --nav-height: 3rem;
    --fab-size: 3.25rem;
    --sheet-max: 34rem;

    /* UI-specific glass layers */
    --ui-stroke: var(--stroke-inner);
    --ui-stroke-2: var(--stroke-outer);

    --ui-glass-strong: var(--glass-strong);
    --ui-glass-mid: var(--glass-1);
    --ui-glass-soft: var(--glass-3);
    --ui-glass-chip: color-mix(in srgb, var(--glass-3) 85%, transparent);

    /* Scrims */
    --sheet-backdrop: color-mix(in srgb, black 58%, transparent);

    /* Snackbar */
    --snackbar-bg: var(--glass-2);
  }
}

@layer layout {
  .app-shell {
    min-block-size: 100dvh;
    background: transparent;
  }

  .app-main {
    background: transparent;
    padding-block: var(--space-5) calc(var(--nav-height) + var(--space-7) + env(safe-area-inset-bottom));
    padding-inline: 0;
    view-transition-name: main-content;
  }

  .page { display: grid; gap: var(--space-5); }
  .page__section { display: grid; gap: var(--space-4); }
}

@layer components {
  body[data-sheet-open="true"] {
    overflow: hidden;
    touch-action: none;
  }

  .route-view[data-vt="false"][data-anim="enter"] {
    animation: page-in var(--dur-2) var(--ease-1);
  }

  /* Bottom nav: floating glass dock */
  .bottom-nav {
    position: fixed;
    inset-block-end: calc(var(--space-2) + env(safe-area-inset-bottom));
    inset-inline: var(--gutter);
    z-index: 100;
    isolation: isolate;
    view-transition-name: bottom-nav;

    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-1);

    padding-block: var(--space-2);
    padding-inline: var(--space-2);

    border-radius: var(--radius-card);
    border: var(--border-1) solid var(--ui-stroke-2);
    background: var(--ui-glass-strong);
    box-shadow: var(--shadow-2);
    overflow: clip;
  }

  @supports (backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px)) {
    .bottom-nav {
      backdrop-filter: blur(var(--glass-blur-soft));
      -webkit-backdrop-filter: blur(var(--glass-blur-soft));
    }
  }

  .bottom-nav__item {
    min-block-size: var(--tap, 48px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2px;

    border-radius: var(--radius-pill);
    font-size: 0.6875rem;
    font-weight: 560;

    color: var(--text-2);
    transition: color var(--dur-quick) var(--ease-standard), filter var(--dur-quick) var(--ease-standard);
    position: relative;
  }

  .bottom-nav__item[aria-current="page"] {
    color: var(--text-1);
  }

  .bottom-nav__item[aria-current="page"]::after {
    content: "";
    position: absolute;
    inset-inline: 20%;
    inset-block-end: 4px;
    inline-size: 60%;
    block-size: 2px;
    border-radius: var(--radius-pill);
    background: color-mix(in srgb, var(--accent-1) 70%, transparent);
    box-shadow: 0 0 14px color-mix(in srgb, var(--accent-1) 35%, transparent);
  }

  .bottom-nav__icon {
    inline-size: 22px;
    block-size: 22px;
    color: currentColor;
  }

  /* Back button: floating thumb-friendly control */
  .back-btn {
    position: fixed;
    inset-inline-end: var(--gutter);
    inset-block-end: calc(var(--nav-height) + var(--space-5) + env(safe-area-inset-bottom));
    z-index: 90;

    inline-size: var(--tap, 48px);
    block-size: var(--tap, 48px);
    padding: 0;
    border-radius: 50%;
    --_height: var(--tap, 48px);
    box-shadow: var(--shadow-2);
  }

  .back-btn:hover { box-shadow: var(--shadow-3); }


  /* Headers: glass bar with soft edge glow */
  .header-bar,
  .runner-header {
    position: sticky;
    inset-block-start: 0;
    z-index: 7;

    padding-block: var(--space-3);
    padding-inline: var(--gutter);

    margin-inline: 0;
    border-bottom: var(--border-1) solid var(--ui-stroke-2);
    background: var(--ui-glass-strong);
    box-shadow: var(--shadow-1);
  }

  @supports (backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px)) {
    .header-bar,
    .runner-header {
      backdrop-filter: blur(var(--glass-blur-soft));
      -webkit-backdrop-filter: blur(var(--glass-blur-soft));
    }
  }

  .header-bar__title {
    font-size: var(--fs-4);
    line-height: var(--lh-tight);
    letter-spacing: -0.02em;
    font-weight: 700;
  }

  .header-bar__subtitle {
    font-size: var(--fs-1);
    color: var(--text-2);
  }

  .runner-header__title {
    font-size: var(--fs-3);
    font-weight: 680;
    letter-spacing: -0.015em;
  }

  .runner-header__row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-3);
  }

  /* Program cards */
  .program-card {
    display: block;
    inline-size: 100%;
    text-align: left;
    cursor: pointer;
  }

  .program-card.card {
    border: var(--border-1) solid var(--ui-stroke-2);
    background: var(--glass-2);
    box-shadow: var(--shadow-1);
  }

  .program-card .card__body {
    padding: var(--space-4);
    gap: var(--space-3);
  }

  .program-card__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-3);
  }

  .program-card__note {
    font-size: var(--fs-1);
    color: var(--text-2);
  }

  /* Active workout emphasis */
  .resume-card {
    position: relative;
  }

  .resume-card .card {
    border: var(--border-1) solid color-mix(in srgb, var(--accent-1) 40%, transparent);
    background: var(--ui-glass-strong);
    box-shadow: var(--shadow-2), var(--glow-brand);
  }

  /* Exercise cards */
  .exercise-card__header { display: grid; gap: var(--space-2); }
  .exercise-card__sets { display: grid; gap: var(--space-3); }
  .exercise-card__actions {
    display: flex;
    justify-content: flex-end;
    padding-top: var(--space-2);
  }
  .exercise-card__add { min-inline-size: 10rem; }

  /* Set row: glass pill tray */
  .set-row {
    display: grid;
    grid-template-columns: minmax(0, 1fr) auto;
    gap: var(--space-3);
    align-items: center;

    padding: var(--space-3);
    border-radius: var(--radius-control);
    border: var(--border-1) solid transparent;
    background: var(--ui-glass-mid);
    box-shadow: var(--shadow-1);

    min-block-size: 56px;
    cursor: pointer;

    transition:
      transform var(--dur-press) var(--ease-standard),
      filter var(--dur-quick) var(--ease-standard),
      box-shadow var(--dur-quick) var(--ease-standard);
  }

  @supports (backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px)) {
    .set-row {
      backdrop-filter: blur(var(--glass-blur-soft));
      -webkit-backdrop-filter: blur(var(--glass-blur-soft));
    }
  }

  .set-row:hover { filter: brightness(1.03); box-shadow: var(--shadow-2); }
  .set-row:active { transform: scale(0.995); }
  .set-row:focus-visible {
    outline: none;
    box-shadow:
      0 0 0 var(--ring-size) color-mix(in srgb, var(--focus-ring) 30%, transparent),
      var(--shadow-2);
  }

  .set-row--static {
    cursor: default;
  }

  .set-row--static:hover {
    filter: none;
    box-shadow: var(--shadow-1);
  }

  .set-row--static:active { transform: none; }

  .set-row__stats {
    display: grid;
    grid-template-columns: minmax(0, 1fr) auto;
    gap: var(--space-3);
    align-items: center;
    min-inline-size: 0;
  }

  .set-row__actions {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    flex-shrink: 0;
  }

  .set-row__stat,
  .set-row__edit {
    inline-size: 100%;
    display: grid;
    gap: var(--space-1);
    padding: var(--space-2) var(--space-3);
    border-radius: var(--radius-pill);
    border: none;
    background: color-mix(in srgb, var(--ui-glass-chip) 88%, transparent);
    text-align: left;
    color: var(--text-1);
  }

  .set-row__stat--reps,
  .set-row__edit.set-row__stat--reps {
    inline-size: auto;
    min-inline-size: 86px;
    text-align: center;
    align-content: center;
  }

  .set-row__label {
    font-size: var(--fs-1);
    color: var(--text-2);
    letter-spacing: -0.01em;
  }

  .set-row__values {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    align-items: center;
  }

  .set-row__pill {
    padding: 2px 10px;
    border-radius: var(--radius-pill);
    border: var(--border-1) solid color-mix(in srgb, white 10%, transparent);
    background: color-mix(in srgb, var(--ui-glass-chip) 92%, transparent);
    font-size: var(--fs-1);
    line-height: 1.4;
  }

  .set-row__sub {
    font-size: var(--fs-1);
    color: var(--text-2);
  }

  .set-row__reps-value {
    font-size: var(--fs-3);
    font-weight: 720;
    line-height: 1;
  }

  .set-row__action,
  .set-row__menu {
    inline-size: 36px;
    block-size: 36px;
    border-radius: var(--radius-pill);
    border: var(--border-1) solid transparent;
    background: color-mix(in srgb, var(--ui-glass-chip) 92%, transparent);
    display: grid;
    place-items: center;
    color: var(--text-2);
    transition: filter var(--dur-quick) var(--ease-standard), color var(--dur-quick) var(--ease-standard);
  }

  .set-row__action:hover,
  .set-row__menu:hover {
    color: var(--text-1);
    filter: brightness(1.04);
  }

  .set-row--highlight {
    --set-highlight-bg: color-mix(in srgb, var(--accent-2) 18%, transparent);
    outline: 2px solid color-mix(in srgb, var(--accent-2) 38%, transparent);
    outline-offset: 0;
    animation: set-highlight-fade var(--dur-2) var(--ease-1) forwards;
  }

  /* Sheet */
  .sheet {
    position: fixed;
    inset: 0;
    z-index: 110;
    display: grid;
    align-items: end;
    justify-items: center;
  }

  .sheet[data-open="false"] { pointer-events: none; }

  .sheet__backdrop {
    position: absolute;
    inset: 0;
    background: var(--sheet-backdrop);
    border: none;
    padding: 0;
    opacity: 0;
    transition: opacity var(--dur-2) var(--ease-1);
  }

  .sheet__panel {
    inline-size: min(100%, var(--sheet-max));
    max-block-size: min(80dvh, 100%);
    margin-inline: auto;
    margin-block-end: env(safe-area-inset-bottom);

    border-radius: var(--radius-card) var(--radius-card) 0 0;
    transform: translateY(20%);
    opacity: 0;
    transition: transform var(--dur-3) var(--ease-2), opacity var(--dur-2) var(--ease-1);

    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
  }

  @supports (backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px)) {
    .sheet__panel {
      backdrop-filter: blur(var(--glass-blur-strong));
      -webkit-backdrop-filter: blur(var(--glass-blur-strong));
    }
  }

  .sheet[data-open="true"] .sheet__panel { transform: translateY(0); opacity: 1; }
  .sheet[data-open="true"] .sheet__backdrop { opacity: 1; }

  .sheet__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-3);
    padding: var(--space-4);
    border-bottom: var(--border-1) solid var(--ui-stroke);
  }

  .sheet__title { font-size: var(--fs-3); letter-spacing: -0.01em; }

  .sheet__content {
    padding: var(--space-5);
    display: grid;
    gap: var(--space-4);
    flex: 1;
    min-block-size: 0;
    overflow: auto;
  }

  .sheet__footer {
    padding: var(--space-4);
    border-top: var(--border-1) solid var(--ui-stroke);
  }

  .sheet__actions { display: flex; justify-content: flex-end; gap: var(--space-3); }

  .sheet__list { display: grid; gap: var(--space-3); }

  .checkbox-field {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    cursor: pointer;
  }

  .checkbox {
    margin: 0;
    flex-shrink: 0;
  }

  /* List trays */
  .list-surface,
  .sheet__list {
    padding: var(--space-2);
    border-radius: var(--radius-card);
    border: var(--border-1) solid var(--ui-stroke);
    background: var(--ui-glass-soft);
    box-shadow: var(--shadow-1);
  }

  @supports (backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px)) {
    .list-surface {
      backdrop-filter: blur(var(--glass-blur-soft));
      -webkit-backdrop-filter: blur(var(--glass-blur-soft));
    }
  }

  /* Stepper: segmented pill tray */
  .stepper {
    display: grid;
    grid-template-columns: auto minmax(0, 1fr) auto;
    gap: var(--space-1);
    align-items: center;
    padding: var(--space-1);
    border-radius: var(--radius-pill);
    border: var(--border-1) solid var(--ui-stroke);
    background: var(--ui-glass-mid);
    box-shadow: var(--shadow-1);
  }

  .stepper .button {
    --_height: 40px;
    padding-inline: var(--space-3);
    background: var(--ui-glass-soft);
    box-shadow: none;
  }

  .stepper .button:hover {
    box-shadow: none;
    filter: brightness(1.03);
  }

  .stepper .input {
    border: none;
    background: transparent;
    box-shadow: none;
    text-align: center;
    font-weight: 800;
    padding-inline: var(--space-2);
  }

  /* Lists */
  .list-row {
    inline-size: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-3);
    padding: var(--space-3);
    border-radius: var(--radius-pill);
    border: var(--border-1) solid var(--ui-stroke);
    background: var(--ui-glass-mid);
    color: var(--text-1);
    box-shadow: var(--shadow-1);
    transition: filter var(--dur-quick) var(--ease-standard), box-shadow var(--dur-quick) var(--ease-standard);
  }

  .list-row:hover { filter: brightness(1.04); box-shadow: var(--shadow-2); }

  /* Summary */
  .summary-page { container-type: inline-size; }

  .summary-page__header {
    align-items: start;
  }

  .summary-page__badge {
    inline-size: 3.25rem;
    block-size: 3.25rem;
    border-radius: 50%;
    border: var(--border-1) solid color-mix(in srgb, var(--accent-1) 35%, transparent);
    background: var(--accent-gradient);
    color: var(--on-brand);
    display: grid;
    place-items: center;
    box-shadow: var(--glow-brand);
  }

  .summary-stats {
    display: grid;
    gap: var(--space-3);
  }

  @container (min-width: 28rem) {
    .summary-stats { grid-template-columns: repeat(3, minmax(0, 1fr)); }
  }

  .summary-stat {
    border-radius: var(--radius-card);
    border: var(--border-1) solid var(--ui-stroke-2);
    padding: var(--space-4);
    background: var(--ui-glass-mid);
    box-shadow: var(--shadow-1);
    display: grid;
    gap: var(--space-1);
  }

  .summary-stat__value {
    font-size: var(--fs-4);
    font-weight: 720;
    letter-spacing: -0.02em;
  }

  .summary-page__sticky {
    position: sticky;
    inset-block-end: calc(var(--nav-height) + var(--space-4));
    display: flex;
    justify-content: flex-end;
  }

  .summary-page__done { min-inline-size: 12rem; }

  /* Snackbar */
  .snackbar {
    position: fixed;
    inset-inline: var(--gutter);
    inset-block-end: calc(var(--nav-height) + var(--space-6) + env(safe-area-inset-bottom));
    z-index: 30;

    border-radius: var(--radius-control);
    border: var(--border-1) solid var(--ui-stroke);
    background: var(--snackbar-bg);

    padding: var(--space-3) var(--space-4);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-3);

    box-shadow: var(--shadow-2);
    animation: snackbar-in var(--dur-2) var(--ease-1);
  }

  @supports (backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px)) {
    .snackbar {
      backdrop-filter: blur(var(--glass-blur-soft));
      -webkit-backdrop-filter: blur(var(--glass-blur-soft));
    }
  }

  /* Floating action button */
  .fab {
    position: fixed;
    inset-inline-end: var(--gutter);
    inset-block-end: calc(var(--nav-height) + var(--space-5) + env(safe-area-inset-bottom));
    inline-size: var(--fab-size);
    block-size: var(--fab-size);
    padding-inline: 0;
    border-radius: 50%;
    font-size: var(--fs-3);
    box-shadow: var(--glow-brand), var(--shadow-2);
  }
}

@layer overrides {
  /* Keep global wrappers transparent */
  :where(.container, .page, .page__section, .route-view, .app-shell, .app-main) {
    background: transparent;
  }

  :where(.surface) {
    background: transparent;
    border-color: transparent;
    box-shadow: none;
  }

  /* Native control rectangle removal */
  :where(input, select, textarea, button) {
    -webkit-appearance: none;
    appearance: none;
    background-clip: padding-box;
  }

  /* Avoid nested flats inside set rows */
  :where(.set-row) :where(input, .input, .select) {
    background: transparent;
    box-shadow: none;
  }

  /* Checkbox/radio surfaces */
  :where(input[type="checkbox"], input[type="radio"]) {
    inline-size: 18px;
    block-size: 18px;
    border-radius: 6px;
    border: var(--border-1) solid color-mix(in srgb, white 18%, transparent);
    background: color-mix(in srgb, var(--neutral-1) 60%, transparent);
  }

  /* Prevent mystery background utilities from introducing slabs */
  :where([class*="bg-"], [class*="background"], [class*="surface"]) {
    background-color: transparent;
  }
}
