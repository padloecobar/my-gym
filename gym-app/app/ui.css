/* ui.css (Mango Voltage Liquid Glass)
   App-level layout + component refinements on top of globals.
*/

@layer reset, tokens, base, layout, components, motion, utilities, overrides;

@layer tokens {
  :root {
    --nav-height: 3rem;
    --fab-size: 3.25rem;
    --sheet-max: 34rem;

    /* UI-specific surfaces */
    --ui-stroke: var(--stroke-inner);
    --ui-stroke-2: var(--stroke-outer);

    --ui-surface-1: var(--surface-1);
    --ui-surface-2: var(--surface-2);
    --ui-surface-3: var(--surface-3);

    /* Scrims */
    --sheet-backdrop: var(--scrim);

    /* Snackbar */
    --snackbar-bg: var(--surface-3);
  }
}

@layer layout {
  .app-shell {
    min-block-size: 100dvh;
    background: transparent;
  }

  .app-main {
    background: transparent;
    padding-block: var(--space-5) calc(var(--nav-height) + var(--space-7) + env(safe-area-inset-bottom));
    padding-inline: 0;
    view-transition-name: main-content;
  }

  .page { display: grid; gap: var(--space-5); }
  .page__section { display: grid; gap: var(--space-4); }
}

@layer components {
  body[data-sheet-open="true"] {
    overflow: hidden;
    touch-action: none;
  }

  .route-view[data-vt="false"][data-anim="enter"] {
    animation: page-in var(--dur-2) var(--ease-1);
  }

  :where(.bottom-nav, .header-bar, .runner-header, .sheet__panel, .snackbar, .list-surface, .set-row, .summary-stat)::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    background: var(--surface-noise);
    opacity: var(--surface-noise-opacity);
    mix-blend-mode: overlay;
  }

  /* Bottom nav: floating glass dock */
  .bottom-nav {
    position: fixed;
    inset-block-end: calc(var(--space-2) + env(safe-area-inset-bottom));
    inset-inline: var(--gutter);
    z-index: 100;
    isolation: isolate;
    view-transition-name: bottom-nav;

    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-1);

    padding-block: var(--space-2);
    padding-inline: var(--space-2);

    border-radius: var(--radius-card);
    border: var(--border-1) solid var(--ui-stroke-2);
    background: var(--ui-surface-3);
    box-shadow: var(--shadow-2), inset 0 1px 0 var(--surface-highlight);
    overflow: clip;
  }

  @supports (backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px)) {
    .bottom-nav {
      backdrop-filter: blur(var(--glass-blur-soft));
      -webkit-backdrop-filter: blur(var(--glass-blur-soft));
    }
  }

  .bottom-nav__item {
    min-block-size: var(--tap, 48px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2px;

    border-radius: var(--radius-pill);
    font-size: var(--fs-1);
    font-weight: 600;

    color: var(--text-2);
    transition:
      color var(--dur-quick) var(--ease-standard),
      filter var(--dur-quick) var(--ease-standard),
      background var(--dur-quick) var(--ease-standard),
      box-shadow var(--dur-quick) var(--ease-standard);
    position: relative;
  }

  .bottom-nav__item:hover {
    color: var(--text-1);
  }

  .bottom-nav__item:active {
    transform: translateY(1px);
  }

  .bottom-nav__item[aria-current="page"] {
    color: var(--text-1);
    background: color-mix(in srgb, var(--surface-2) 60%, transparent);
    box-shadow: inset 0 1px 0 var(--surface-highlight), 0 0 24px color-mix(in srgb, var(--cool-1) 22%, transparent);
  }

  .bottom-nav__item:focus-visible {
    outline: none;
    box-shadow: 0 0 0 var(--ring-size) color-mix(in srgb, var(--focus-ring) 45%, transparent);
  }

  .bottom-nav__icon {
    inline-size: 22px;
    block-size: 22px;
    color: currentColor;
  }

  /* Back button: floating thumb-friendly control */
  .back-btn {
    position: fixed;
    inset-inline-end: var(--gutter);
    inset-block-end: calc(var(--nav-height) + var(--space-5) + env(safe-area-inset-bottom));
    z-index: 90;
  }

  .back-btn:hover { box-shadow: var(--shadow-3), inset 0 1px 0 var(--surface-highlight); }


  /* Headers: glass bar with soft edge glow */
  .header-bar,
  .runner-header {
    position: sticky;
    inset-block-start: 0;
    z-index: 7;

    padding-block: var(--space-3);
    padding-inline: var(--gutter);

    margin-inline: 0;
    border-bottom: var(--border-1) solid var(--ui-stroke-2);
    background: var(--ui-surface-3);
    box-shadow: var(--shadow-1), inset 0 1px 0 var(--surface-highlight);
    overflow: clip;
  }

  @supports (backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px)) {
    .header-bar,
    .runner-header {
      backdrop-filter: blur(var(--glass-blur-soft));
      -webkit-backdrop-filter: blur(var(--glass-blur-soft));
    }
  }

  .header-bar__title {
    font-weight: 700;
    text-shadow: var(--text-shadow);
  }

  .header-bar__subtitle {
    font-size: var(--fs-1);
    color: var(--text-2);
  }

  .runner-header__title {
    font-weight: 680;
    text-shadow: var(--text-shadow);
  }

  .runner-header__row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-3);
  }

  /* Program cards */
  .program-card {
    display: block;
    inline-size: 100%;
    text-align: left;
    cursor: pointer;
  }

  .program-card.card {
    border: var(--border-1) solid var(--ui-stroke-2);
    background: var(--ui-surface-1);
    box-shadow: var(--shadow-1), inset 0 1px 0 var(--surface-highlight);
  }

  .program-card .card__body {
    padding: var(--space-4);
    gap: var(--space-3);
  }

  .program-card__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-3);
  }

  .program-card__note {
    font-size: var(--fs-1);
    color: var(--text-2);
  }

  /* Active workout emphasis */
  .resume-card {
    position: relative;
  }

  .resume-card .card {
    border: var(--border-1) solid color-mix(in srgb, var(--hot-1) 24%, transparent);
    background: var(--ui-surface-1);
    box-shadow: var(--shadow-2), var(--glow-hot), inset 0 1px 0 var(--surface-highlight);
  }

  /* Exercise cards */
  .exercise-card__header { display: grid; gap: var(--space-2); }
  .exercise-card__sets { display: grid; gap: var(--space-3); }
  .exercise-card__actions {
    display: flex;
    justify-content: flex-end;
    padding-top: var(--space-2);
  }
  .exercise-card__add { min-inline-size: 10rem; }

  /* Set row: glass pill tray */
  .set-row {
    display: grid;
    grid-template-columns: minmax(0, 1fr) auto;
    gap: var(--space-3);
    align-items: center;

    padding: var(--space-3);
    border-radius: var(--radius-control);
    border: var(--border-1) solid transparent;
    background: var(--tray-bg);
    box-shadow: var(--shadow-1), inset 0 1px 0 var(--tray-sheen);

    min-block-size: 72px;
    cursor: pointer;
    position: relative;

    transition:
      transform var(--dur-press) var(--ease-standard),
      filter var(--dur-quick) var(--ease-standard),
      box-shadow var(--dur-quick) var(--ease-standard);
  }

  @supports (backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px)) {
    .set-row {
      backdrop-filter: blur(var(--glass-blur-soft));
      -webkit-backdrop-filter: blur(var(--glass-blur-soft));
    }
  }

  .set-row:hover { filter: brightness(1.03); }
  .set-row:active { transform: scale(0.995); }
  .set-row:focus-visible {
    outline: none;
    box-shadow:
      0 0 0 var(--ring-size) color-mix(in srgb, var(--focus-ring) 30%, transparent),
      var(--shadow-2);
  }

  .set-row--static {
    cursor: default;
  }

  .set-row--static:hover {
    filter: none;
    box-shadow: var(--shadow-1);
  }

  .set-row--static:active { transform: none; }

  .set-row__stats {
    display: grid;
    grid-template-columns: minmax(0, 1fr) auto;
    gap: var(--space-3);
    align-items: center;
    min-inline-size: 0;
  }

  .set-row__actions {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    flex-shrink: 0;
  }

  .set-row__stat,
  .set-row__edit {
    inline-size: 100%;
    display: grid;
    gap: var(--space-1);
    padding: var(--space-2);
    min-block-size: var(--tap, 48px);
    border-radius: var(--radius-control);
    border: none;
    background: transparent;
    text-align: left;
    color: var(--text-1);
  }

  .set-row__stat--reps,
  .set-row__edit.set-row__stat--reps {
    inline-size: auto;
    min-inline-size: 86px;
    text-align: center;
    align-content: center;
    justify-items: center;
  }

  .set-row__label {
    font-size: var(--fs-1);
    color: var(--text-3);
    letter-spacing: -0.01em;
  }

  .set-row__values {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    align-items: center;
  }

  .set-row__sub {
    font-size: var(--fs-1);
    color: var(--text-2);
  }

  .set-row__action {
    flex-shrink: 0;
    background: transparent;
    border-color: transparent;
    box-shadow: none;
    color: var(--text-2);
    opacity: 0.6;
    transition:
      opacity var(--dur-quick) var(--ease-standard),
      transform var(--dur-press) var(--ease-standard),
      color var(--dur-quick) var(--ease-standard),
      background var(--dur-quick) var(--ease-standard);
  }

  .set-row:hover .set-row__action,
  .set-row:focus-within .set-row__action {
    opacity: 0.9;
    color: var(--text-1);
    background: color-mix(in srgb, var(--surface-2) 35%, transparent);
  }

  @media (hover: hover) {
    .set-row__action { opacity: 0; }
    .set-row:hover .set-row__action,
    .set-row:focus-within .set-row__action { opacity: 0.9; }
  }
  }

  .set-row--highlight {
    --set-highlight-bg: color-mix(in srgb, var(--hot-2) 18%, transparent);
    outline: 2px solid color-mix(in srgb, var(--hot-2) 40%, transparent);
    outline-offset: 0;
    animation: set-highlight-fade var(--dur-2) var(--ease-1) forwards;
  }

  /* Sheet */
  .sheet {
    position: fixed;
    inset: 0;
    z-index: 110;
    display: grid;
    align-items: end;
    justify-items: center;
  }

  .sheet[data-open="false"] { pointer-events: none; }

  .sheet__backdrop {
    position: absolute;
    inset: 0;
    background: var(--sheet-backdrop);
    border: none;
    padding: 0;
    opacity: 0;
    transition: opacity var(--dur-2) var(--ease-1);
  }

  .sheet__panel {
    inline-size: min(100%, var(--sheet-max));
    max-block-size: min(80dvh, 100%);
    margin-inline: auto;
    margin-block-end: env(safe-area-inset-bottom);

    border-radius: var(--radius-card) var(--radius-card) 0 0;
    border: var(--border-1) solid var(--ui-stroke-2);
    background: var(--ui-surface-3);
    box-shadow: var(--shadow-3), inset 0 1px 0 var(--surface-highlight);
    transform: translateY(20%);
    filter: blur(8px);
    opacity: 0;
    transition:
      transform var(--dur-3) var(--ease-2),
      opacity var(--dur-2) var(--ease-1),
      filter var(--dur-2) var(--ease-1);

    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
  }

  @supports (backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px)) {
    .sheet__panel {
      backdrop-filter: blur(var(--glass-blur-strong));
      -webkit-backdrop-filter: blur(var(--glass-blur-strong));
    }
  }

  .sheet[data-open="true"] .sheet__panel { transform: translateY(0); opacity: 1; filter: blur(0); }
  .sheet[data-open="true"] .sheet__backdrop { opacity: 1; }

  .sheet__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-3);
    padding: var(--space-4);
    border-bottom: var(--border-1) solid var(--tray-sheen);
  }

  .sheet__title { font-size: var(--fs-3); letter-spacing: -0.01em; }
  .sheet__title { text-shadow: var(--text-shadow); }

  .sheet__content {
    padding: var(--space-5);
    display: grid;
    gap: var(--space-4);
    flex: 1;
    min-block-size: 0;
    overflow: auto;
  }

  .sheet__footer {
    padding: var(--space-4);
    border-top: var(--border-1) solid var(--tray-sheen);
  }

  .sheet__actions { display: flex; justify-content: flex-end; gap: var(--space-3); }

  .sheet__list { display: grid; gap: var(--space-3); }

  .checkbox-field {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    cursor: pointer;
  }

  .checkbox {
    margin: 0;
    flex-shrink: 0;
  }

  /* List trays */
  .list-surface,
  .sheet__list {
    padding: var(--space-2);
    border-radius: var(--radius-card);
    border: var(--border-1) solid transparent;
    background: var(--tray-bg);
    box-shadow: var(--shadow-1), inset 0 1px 0 var(--tray-sheen);
    position: relative;
    overflow: clip;
  }

  @supports (backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px)) {
    .list-surface {
      backdrop-filter: blur(var(--glass-blur-soft));
      -webkit-backdrop-filter: blur(var(--glass-blur-soft));
    }
  }

  /* Stepper: segmented pill tray */
  .stepper {
    display: grid;
    grid-template-columns: auto minmax(0, 1fr) auto;
    gap: var(--space-1);
    align-items: center;
    padding: var(--space-1);
    border-radius: var(--radius-pill);
    border: var(--border-1) solid transparent;
    background: var(--tray-bg);
    box-shadow: var(--shadow-1), inset 0 1px 0 var(--tray-sheen);
  }

  .stepper .button {
    --_height: 48px;
    padding-inline: var(--space-3);
    background: var(--surface-2);
    box-shadow: none;
  }

  .stepper .button:hover {
    box-shadow: none;
    filter: brightness(1.03);
  }

  .stepper .input {
    border: none;
    background: transparent;
    box-shadow: none;
    text-align: center;
    font-weight: 800;
    padding-inline: var(--space-2);
  }

  /* Lists */
  .list-row {
    inline-size: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-3);
    padding: var(--space-3);
    border-radius: var(--radius-pill);
    border: var(--border-1) solid transparent;
    background: color-mix(in srgb, var(--surface-2) 48%, transparent);
    color: var(--text-1);
    box-shadow: var(--shadow-1), inset 0 1px 0 var(--surface-highlight);
    min-block-size: var(--tap, 48px);
    position: relative;
    overflow: clip;
    transition:
      filter var(--dur-quick) var(--ease-standard),
      box-shadow var(--dur-quick) var(--ease-standard),
      transform var(--dur-press) var(--ease-standard);
  }

  .list-row:hover { filter: brightness(1.04); }
  .list-row:active { transform: translateY(1px); }
  .list-row:disabled { opacity: 0.6; cursor: not-allowed; }

  .list-row:focus-visible {
    outline: none;
    box-shadow:
      0 0 0 var(--ring-size) color-mix(in srgb, var(--focus-ring) 45%, transparent),
      var(--shadow-2);
  }

  .list-surface .list-row,
  .sheet__list .list-row {
    background: color-mix(in srgb, var(--surface-2) 42%, transparent);
    box-shadow: inset 0 1px 0 var(--tray-sheen);
  }

  .list-surface .list-row:hover,
  .sheet__list .list-row:hover {
    box-shadow: inset 0 1px 0 var(--tray-sheen);
  }

  /* Summary */
  .summary-page { container-type: inline-size; }

  .summary-page__header {
    align-items: start;
  }

  .summary-page__badge {
    inline-size: 3.25rem;
    block-size: 3.25rem;
    border-radius: 50%;
    border: var(--border-1) solid color-mix(in srgb, var(--hot-1) 45%, transparent);
    background: color-mix(in srgb, var(--surface-2) 70%, var(--hot-1) 30%);
    color: var(--text-1);
    display: grid;
    place-items: center;
    box-shadow: var(--glow-hot);
  }

  .summary-stats {
    display: grid;
    gap: var(--space-3);
  }

  @container (min-width: 28rem) {
    .summary-stats { grid-template-columns: repeat(3, minmax(0, 1fr)); }
  }

  .summary-stat {
    border-radius: var(--radius-card);
    border: var(--border-1) solid var(--ui-stroke-2);
    padding: var(--space-4);
    background: var(--ui-surface-2);
    box-shadow: var(--shadow-1), inset 0 1px 0 var(--surface-highlight);
    display: grid;
    gap: var(--space-1);
    position: relative;
    overflow: clip;
  }

  .summary-stat__value {
    font-size: var(--fs-4);
    font-weight: 720;
    letter-spacing: -0.02em;
    text-shadow: var(--text-shadow);
  }

  .summary-page__sticky {
    position: sticky;
    inset-block-end: calc(var(--nav-height) + var(--space-4));
    display: flex;
    justify-content: flex-end;
  }

  .summary-page__done { min-inline-size: 12rem; }

  /* Snackbar */
  .snackbar {
    position: fixed;
    inset-inline: var(--gutter);
    inset-block-end: calc(var(--nav-height) + var(--space-6) + env(safe-area-inset-bottom));
    z-index: 30;

    border-radius: var(--radius-control);
    border: var(--border-1) solid var(--ui-stroke-2);
    background: var(--snackbar-bg);

    padding: var(--space-3) var(--space-4);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-3);

    box-shadow: var(--shadow-2), inset 0 1px 0 var(--surface-highlight);
    position: relative;
    overflow: clip;
    animation: snackbar-in var(--dur-2) var(--ease-1);
  }

  @supports (backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px)) {
    .snackbar {
      backdrop-filter: blur(var(--glass-blur-soft));
      -webkit-backdrop-filter: blur(var(--glass-blur-soft));
    }
  }

  /* Floating action button */
  .fab {
    position: fixed;
    inset-inline-end: var(--gutter);
    inset-block-end: calc(var(--nav-height) + var(--space-5) + env(safe-area-inset-bottom));
    inline-size: var(--fab-size);
    block-size: var(--fab-size);
    padding-inline: 0;
    border-radius: 50%;
    font-size: var(--fs-3);
    box-shadow: var(--glow-hot), var(--shadow-2);
  }
}

@layer overrides {
  /* Keep global wrappers transparent */
  :where(.container, .page, .page__section, .route-view, .app-shell, .app-main) {
    background: transparent;
  }

  /* Native control rectangle removal */
  :where(input, select, textarea, button) {
    -webkit-appearance: none;
    appearance: none;
    background-clip: padding-box;
  }

  /* Avoid nested flats inside set rows */
  :where(.set-row) :where(input, .input, .select) {
    background: transparent;
    box-shadow: none;
  }

  /* Checkbox/radio surfaces */
  :where(input[type="checkbox"], input[type="radio"]) {
    inline-size: 20px;
    block-size: 20px;
    border-radius: 6px;
    border: var(--border-1) solid var(--stroke-inner);
    background: var(--surface-2);
  }

}
